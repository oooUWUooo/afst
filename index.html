<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Library Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            color: #333;
            margin-bottom: 16px;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: #6c757d;
        }

        button.danger {
            background: #dc3545;
        }

        button.success {
            background: #28a745;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-primary {
            background: #667eea;
            color: white;
        }

        .hidden {
            display: none !important;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            font-weight: 600;
            font-size: 14px;
        }

        .status-connected {
            color: #28a745;
        }

        .status-disconnected {
            color: #dc3545;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            color: #666;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö Library Management System</h1>

        <!-- Status Bar -->
        <div class="status-bar">
            <span class="status-indicator" id="statusIndicator">‚ö™ –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
            <div>
                <button id="changeApiBtn" class="secondary" style="margin-right: 8px;">‚öôÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å API</button>
                <button id="logoutBtn" class="danger hidden">–í—ã—Ö–æ–¥</button>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer"></div>

        <!-- API Configuration -->
        <div class="card" id="apiConfigCard">
            <h3>üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API</h3>
            <div class="form-group">
                <label>URL Backend API</label>
                <input type="url" id="apiUrl" placeholder="https://your-backend.onrender.com">
                <small style="color: #666; display: block; margin-top: 4px;">
                    –í–≤–µ–¥–∏—Ç–µ URL –≤–∞—à–µ–≥–æ –±—ç–∫–µ–Ω–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://library-api.onrender.com)
                </small>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="saveApiUrl()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL</button>
                <button class="secondary" onclick="clearApiUrl()" id="clearApiBtn" style="display: none;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="currentApiDisplay" style="margin-top: 12px; padding: 10px; background: #f0f0f0; border-radius: 6px; display: none;">
                <strong>–¢–µ–∫—É—â–∏–π API:</strong> <span id="currentApiUrl"></span>
            </div>
        </div>

        <!-- Authentication Section -->
        <div class="card hidden" id="authCard">
            <h3>üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
            
            <div class="tabs">
                <button class="tab active" data-tab="login">–í—Ö–æ–¥</button>
                <button class="tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <!-- Login Form -->
            <div class="tab-content active" data-content="login">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" placeholder="–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤">
                </div>
                <button onclick="login()">üîì –í–æ–π—Ç–∏</button>
            </div>

            <!-- Register Form -->
            <div class="tab-content" data-content="register">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="registerEmail" placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="registerPassword" placeholder="–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã">
                </div>
                <button onclick="register()">‚úçÔ∏è –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="hidden">
            <!-- Books Section -->
            <div class="card">
                <h3>üìñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∞–º–∏</h3>
                <div class="grid">
                    <!-- Add Book Form -->
                    <div>
                        <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</h4>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                            <input type="text" id="bookTitle" required>
                        </div>
                        <div class="form-group">
                            <label>–ê–≤—Ç–æ—Ä *</label>
                            <input type="text" id="bookAuthor" required>
                        </div>
                        <div class="form-group">
                            <label>–ì–æ–¥</label>
                            <input type="number" id="bookYear" min="1000" max="2100">
                        </div>
                        <div class="form-group">
                            <label>ISBN</label>
                            <input type="text" id="bookIsbn">
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                            <input type="number" id="bookCopies" value="1" min="0">
                        </div>
                        <div class="form-group">
                            <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea id="bookDescription"></textarea>
                        </div>
                        <button class="success" onclick="addBook()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</button>
                    </div>

                    <!-- Books List -->
                    <div>
                        <h4>–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</h4>
                        <button class="secondary" onclick="loadBooks()" style="margin-bottom: 10px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                        <div id="booksList">
                            <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Readers Section -->
            <div class="card">
                <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∏—Ç–∞—Ç–µ–ª—è–º–∏</h3>
                <div class="grid">
                    <!-- Add Reader Form -->
                    <div>
                        <h4>–î–æ–±–∞–≤–∏—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è</h4>
                        <div class="form-group">
                            <label>–ò–º—è *</label>
                            <input type="text" id="readerName" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="readerEmail" required>
                        </div>
                        <button class="success" onclick="addReader()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è</button>
                    </div>

                    <!-- Readers List -->
                    <div>
                        <h4>–°–ø–∏—Å–æ–∫ —á–∏—Ç–∞—Ç–µ–ª–µ–π</h4>
                        <button class="secondary" onclick="loadReaders()" style="margin-bottom: 10px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                        <div id="readersList">
                            <div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Borrow/Return Section -->
            <div class="card">
                <h3>üì§ –í—ã–¥–∞—á–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥</h3>
                <div class="grid">
                    <div>
                        <h4>–í—ã–¥–∞—Ç—å –∫–Ω–∏–≥—É</h4>
                        <div class="form-group">
                            <label>ID –∫–Ω–∏–≥–∏ *</label>
                            <input type="number" id="borrowBookId" required>
                        </div>
                        <div class="form-group">
                            <label>ID —á–∏—Ç–∞—Ç–µ–ª—è *</label>
                            <input type="number" id="borrowReaderId" required>
                        </div>
                        <button class="success" onclick="borrowBook()">üì§ –í—ã–¥–∞—Ç—å</button>
                    </div>

                    <div>
                        <h4>–í–µ—Ä–Ω—É—Ç—å –∫–Ω–∏–≥—É</h4>
                        <div class="form-group">
                            <label>ID –∫–Ω–∏–≥–∏ *</label>
                            <input type="number" id="returnBookId" required>
                        </div>
                        <div class="form-group">
                            <label>ID —á–∏—Ç–∞—Ç–µ–ª—è *</label>
                            <input type="number" id="returnReaderId" required>
                        </div>
                        <button onclick="returnBook()">üì• –í–µ—Ä–Ω—É—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============= STATE =============
        let API_URL = localStorage.getItem('apiUrl') || '';
        let TOKEN = localStorage.getItem('authToken') || '';

        // ============= INITIALIZATION =============
        window.addEventListener('DOMContentLoaded', () => {
            const savedUrl = localStorage.getItem('apiUrl');
            if (savedUrl) {
                document.getElementById('apiUrl').value = savedUrl;
                API_URL = savedUrl;
            }
            
            // Setup tabs
            setupTabs();
            
            // Setup logout button
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Setup change API button
            document.getElementById('changeApiBtn').addEventListener('click', showApiConfig);
            
            updateUI();
        });

        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active from all tabs and contents
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active to clicked tab and corresponding content
                    this.classList.add('active');
                    document.querySelector(`.tab-content[data-content="${targetTab}"]`).classList.add('active');
                });
            });
        }

        // ============= UTILITY FUNCTIONS =============
        function showAlert(message, type = 'info') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }

        function updateUI() {
            const isConfigured = !!API_URL;
            const isAuthenticated = !!TOKEN;

            // Show/hide sections based on state
            const showApiConfig = !isConfigured;
            document.getElementById('apiConfigCard').classList.toggle('hidden', !showApiConfig);
            document.getElementById('authCard').classList.toggle('hidden', !isConfigured || isAuthenticated);
            document.getElementById('mainContent').classList.toggle('hidden', !isAuthenticated);
            document.getElementById('logoutBtn').classList.toggle('hidden', !isAuthenticated);
            
            // Show change API button when configured
            document.getElementById('changeApiBtn').classList.toggle('hidden', !isConfigured);
            
            // Show current API if configured
            if (isConfigured) {
                document.getElementById('currentApiDisplay').style.display = 'block';
                document.getElementById('currentApiUrl').textContent = API_URL;
                document.getElementById('clearApiBtn').style.display = 'inline-block';
            }

            const statusEl = document.getElementById('statusIndicator');
            if (isAuthenticated) {
                statusEl.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ ' + API_URL.replace('https://', '').replace('http://', '');
                statusEl.className = 'status-indicator status-connected';
            } else if (isConfigured) {
                statusEl.textContent = 'üîì –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ö–æ–¥–∞';
                statusEl.className = 'status-indicator status-disconnected';
            } else {
                statusEl.textContent = '‚ö™ –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ';
                statusEl.className = 'status-indicator status-disconnected';
            }

            if (isAuthenticated) {
                loadBooks();
                loadReaders();
            }
        }

        async function apiRequest(endpoint, options = {}) {
            try {
                const config = {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                };

                if (TOKEN && !options.skipAuth) {
                    config.headers['Authorization'] = `Bearer ${TOKEN}`;
                }

                const response = await fetch(`${API_URL}${endpoint}`, config);
                
                if (!response.ok) {
                    const error = await response.json().catch(() => ({ detail: 'Unknown error' }));
                    throw new Error(error.detail || `HTTP ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                showAlert(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                throw error;
            }
        }

        // ============= API CONFIGURATION =============
        function showApiConfig() {
            document.getElementById('apiConfigCard').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveApiUrl() {
            const url = document.getElementById('apiUrl').value.trim();
            if (!url) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ URL API', 'error');
                return;
            }

            try {
                new URL(url);
                
                // If changing API, logout first
                if (API_URL && API_URL !== url && TOKEN) {
                    TOKEN = '';
                    localStorage.removeItem('authToken');
                    showAlert('API –∏–∑–º–µ–Ω—ë–Ω. –í–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.', 'info');
                }
                
                API_URL = url.replace(/\/$/, '');
                localStorage.setItem('apiUrl', API_URL);
                showAlert('URL —Å–æ—Ö—Ä–∞–Ω—ë–Ω!', 'success');
                updateUI();
            } catch (e) {
                showAlert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL', 'error');
            }
        }

        function clearApiUrl() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—ã –≤—ã–π–¥–µ—Ç–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã.')) {
                API_URL = '';
                TOKEN = '';
                localStorage.removeItem('apiUrl');
                localStorage.removeItem('authToken');
                document.getElementById('apiUrl').value = '';
                document.getElementById('currentApiDisplay').style.display = 'none';
                document.getElementById('clearApiBtn').style.display = 'none';
                showAlert('API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—á–∏—â–µ–Ω—ã', 'info');
                updateUI();
            }
        }

        // ============= AUTHENTICATION =============
        async function register() {
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;

            if (!email || !password) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                await apiRequest('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({ email, password }),
                    skipAuth: true
                });
                showAlert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.', 'success');
                
                // Switch to login tab
                document.querySelector('.tab[data-tab="login"]').click();
                
                // Clear register fields
                document.getElementById('registerEmail').value = '';
                document.getElementById('registerPassword').value = '';
            } catch (error) {
                console.error('Registration failed:', error);
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                const formData = new URLSearchParams();
                formData.append('username', email);
                formData.append('password', password);

                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json().catch(() => ({ detail: 'Login failed' }));
                    throw new Error(error.detail || '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                }

                const data = await response.json();
                TOKEN = data.access_token;
                localStorage.setItem('authToken', TOKEN);
                
                showAlert('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                updateUI();
            } catch (error) {
                showAlert(`–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${error.message}`, 'error');
            }
        }

        function logout() {
            TOKEN = '';
            localStorage.removeItem('authToken');
            showAlert('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
            updateUI();
        }

        // ============= BOOKS =============
        async function loadBooks() {
            try {
                const books = await apiRequest('/books/');
                const container = document.getElementById('booksList');
                
                if (!books || books.length === 0) {
                    container.innerHTML = '<div class="empty-state">–ö–Ω–∏–≥ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                    return;
                }

                container.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ê–≤—Ç–æ—Ä</th>
                                <th>–ì–æ–¥</th>
                                <th>–ö–æ–ø–∏–π</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${books.map(b => `
                                <tr>
                                    <td><span class="badge badge-primary">#${b.id}</span></td>
                                    <td><strong>${b.title}</strong></td>
                                    <td>${b.author}</td>
                                    <td>${b.year || '-'}</td>
                                    <td>${b.copies}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                document.getElementById('booksList').innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        async function addBook() {
            const title = document.getElementById('bookTitle').value.trim();
            const author = document.getElementById('bookAuthor').value.trim();
            const year = document.getElementById('bookYear').value;
            const isbn = document.getElementById('bookIsbn').value.trim();
            const copies = parseInt(document.getElementById('bookCopies').value) || 1;
            const description = document.getElementById('bookDescription').value.trim();

            if (!title || !author) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∞–≤—Ç–æ—Ä–∞', 'error');
                return;
            }

            try {
                await apiRequest('/books/', {
                    method: 'POST',
                    body: JSON.stringify({
                        title,
                        author,
                        year: year ? parseInt(year) : null,
                        isbn: isbn || null,
                        copies,
                        description: description || null
                    })
                });

                showAlert('–ö–Ω–∏–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                document.getElementById('bookTitle').value = '';
                document.getElementById('bookAuthor').value = '';
                document.getElementById('bookYear').value = '';
                document.getElementById('bookIsbn').value = '';
                document.getElementById('bookCopies').value = '1';
                document.getElementById('bookDescription').value = '';
                loadBooks();
            } catch (error) {
                console.error('Failed to add book:', error);
            }
        }

        // ============= READERS =============
        async function loadReaders() {
            try {
                const readers = await apiRequest('/readers/');
                const container = document.getElementById('readersList');
                
                if (!readers || readers.length === 0) {
                    container.innerHTML = '<div class="empty-state">–ß–∏—Ç–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                    return;
                }

                container.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ò–º—è</th>
                                <th>Email</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${readers.map(r => `
                                <tr>
                                    <td><span class="badge badge-primary">#${r.id}</span></td>
                                    <td><strong>${r.name}</strong></td>
                                    <td>${r.email}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                document.getElementById('readersList').innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }

        async function addReader() {
            const name = document.getElementById('readerName').value.trim();
            const email = document.getElementById('readerEmail').value.trim();

            if (!name || !email) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                await apiRequest('/readers/', {
                    method: 'POST',
                    body: JSON.stringify({ name, email })
                });

                showAlert('–ß–∏—Ç–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                document.getElementById('readerName').value = '';
                document.getElementById('readerEmail').value = '';
                loadReaders();
            } catch (error) {
                console.error('Failed to add reader:', error);
            }
        }

        // ============= BORROW/RETURN =============
        async function borrowBook() {
            const bookId = parseInt(document.getElementById('borrowBookId').value);
            const readerId = parseInt(document.getElementById('borrowReaderId').value);

            if (!bookId || !readerId) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                await apiRequest('/borrows/borrow', {
                    method: 'POST',
                    body: JSON.stringify({ book_id: bookId, reader_id: readerId })
                });

                showAlert('–ö–Ω–∏–≥–∞ –≤—ã–¥–∞–Ω–∞!', 'success');
                document.getElementById('borrowBookId').value = '';
                document.getElementById('borrowReaderId').value = '';
                loadBooks();
            } catch (error) {
                console.error('Failed to borrow book:', error);
            }
        }

        async function returnBook() {
            const bookId = parseInt(document.getElementById('returnBookId').value);
            const readerId = parseInt(document.getElementById('returnReaderId').value);

            if (!bookId || !readerId) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                await apiRequest('/borrows/return', {
                    method: 'POST',
                    body: JSON.stringify({ book_id: bookId, reader_id: readerId })
                });

                showAlert('–ö–Ω–∏–≥–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞!', 'success');
                document.getElementById('returnBookId').value = '';
                document.getElementById('returnReaderId').value = '';
                loadBooks();
            } catch (error) {
                console.error('Failed to return book:', error);
            }
        }
    </script>
</body>
</html>
